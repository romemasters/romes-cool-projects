---
// src/pages/index.astro

import fs from 'fs';
import path from 'path';

const user = "romemasters";
const repo = "romes-cool-projects";
const branch = "main";
const textsDir = path.resolve('public', 'texts');
const files = fs.existsSync(textsDir) ? fs.readdirSync(textsDir) : [];
const logoUrl = "https://raw.githubusercontent.com/romemasters/romes-cool-projects/refs/heads/main/public/468-4684000_png-file-svg-easy-storage-icon-transparent-png.png";
---

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Code Unit · Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --cf-orange: #f38020;
      --cf-orange-light: #ffb47e;
      --cf-bg: #f7f8fa;
      --cf-dark: #22243a;
      --cf-sidebar: #23263b;
      --cf-card: #fff;
      --cf-border: #e8e8ed;
      --cf-gray: #a0a4ab;
      --cf-shadow: 0 4px 20px #22243a15;
    }
    body {
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: var(--cf-bg);
      color: var(--cf-dark);
      margin: 0;
      min-height: 100vh;
    }
    .cf-loader {
      position: fixed;
      z-index: 99999;
      inset: 0;
      background: var(--cf-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.5s;
      opacity: 1;
      pointer-events: all;
    }
    .cf-loader.hide {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
    }
    .cf-loader-logo {
      width: 70px;
      height: 70px;
      margin-bottom: 1.5rem;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 12px #f3802012;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cf-loader-dots {
      display: flex;
      gap: 0.5em;
      justify-content: center;
      align-items: center;
      margin-top: 0.8em;
    }
    .cf-dot {
      width: 13px;
      height: 13px;
      border-radius: 50%;
      background: var(--cf-orange);
      opacity: 0.5;
      animation: cf-bounce 1.2s infinite;
    }
    .cf-dot:nth-child(2) { animation-delay: 0.15s }
    .cf-dot:nth-child(3) { animation-delay: 0.3s }
    @keyframes cf-bounce {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5;}
      40% { transform: scale(1.1); opacity: 1;}
    }
    /* Dashboard Styles */
    .cf-topbar {
      width: 100vw;
      background: var(--cf-card);
      border-bottom: 1px solid var(--cf-border);
      height: 58px;
      display: flex;
      align-items: center;
      padding-left: 250px;
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 11;
      box-shadow: 0 1px 8px #22243a08;
    }
    .cf-topbar-logo {
      width: 36px;
      height: 36px;
      margin-right: 1.1em;
      vertical-align: middle;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px #f3802012;
      object-fit: contain;
    }
    .cf-topbar-title {
      font-size: 1.35rem;
      font-weight: 800;
      color: var(--cf-orange);
      letter-spacing: 0.7px;
    }
    .cf-sidebar {
      position: fixed;
      width: 250px;
      top: 0;
      left: 0;
      bottom: 0;
      background: var(--cf-sidebar);
      color: #fff;
      padding: 1.8rem 0 0 0;
      z-index: 12;
      border-right: 1px solid var(--cf-border);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .cf-side-nav {
      width: 100%;
      display: flex;
      flex-direction: column;
      margin-top: 2rem;
      gap: 0.3em;
    }
    .cf-side-link {
      color: #fff;
      text-decoration: none;
      display: flex;
      align-items: center;
      font-weight: 600;
      font-size: 1.09em;
      padding: 0.7em 2.1em 0.7em 2.2em;
      border-radius: 10px 0 0 10px;
      margin-bottom: 0.3em;
      transition: background 0.16s, color 0.18s;
      gap: 1.1em;
    }
    .cf-side-link.active, .cf-side-link:hover {
      background: #fff;
      color: var(--cf-orange);
    }
    .cf-side-link svg {
      width: 1.2em;
      height: 1.2em;
      fill: currentColor;
    }
    /* Main content */
    .cf-main {
      margin-left: 250px;
      padding: 80px 2.5vw 2vw 2.5vw;
      min-height: 100vh;
      max-width: 950px;
      position: relative;
    }
    @media (max-width: 900px) {
      .cf-main { padding: 80px 0.6em 1em 0.6em; }
    }
    @media (max-width: 650px) {
      .cf-sidebar {
        width: 63px;
        min-width: 63px;
        padding: 0.6em 0 0 0;
      }
      .cf-side-link, .cf-side-link.active, .cf-side-link:hover {
        padding: 1em 0.7em;
        border-radius: 10px;
        justify-content: center;
        font-size: 1.15em;
      }
      .cf-topbar {
        padding-left: 63px;
      }
      .cf-topbar-title { font-size: 1.07em; }
      .cf-main { margin-left: 63px; }
    }
    .cf-section {
      margin-bottom: 3em;
    }
    .cf-card {
      background: var(--cf-card);
      border-radius: 15px;
      padding: 2.2em 2em 1.7em 2em;
      box-shadow: var(--cf-shadow);
      margin-bottom: 2.7em;
      border: 1px solid var(--cf-border);
      max-width: 700px;
    }
    .cf-card-h {
      font-size: 1.2em;
      color: var(--cf-orange);
      font-weight: 700;
      margin-bottom: 1.2em;
      letter-spacing: 0.2px;
    }
    .cf-desc {
      color: var(--cf-gray);
      font-size: 1.07em;
      margin-bottom: 2.3em;
      line-height: 1.7;
    }
    .cf-file-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .cf-file-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.1em 0.8em;
      border-radius: 10px;
      margin-bottom: 0.6em;
      background: #f7f8fa;
      border: 1px solid var(--cf-border);
      transition: box-shadow 0.13s, border 0.13s, background 0.13s;
      box-shadow: 0 1px 4px #f3802011;
    }
    .cf-file-row:hover {
      box-shadow: 0 4px 18px #f3802022;
      border: 1px solid var(--cf-orange-light);
      background: #fff8f2;
    }
    .cf-file-link {
      color: var(--cf-dark);
      text-decoration: none;
      font-weight: 600;
      font-size: 1.07em;
      letter-spacing: 0.2px;
      flex: 1;
      transition: color 0.17s;
    }
    .cf-file-link:hover {
      color: var(--cf-orange);
      text-decoration: underline;
    }
    .cf-edit-btn {
      background: none;
      border: none;
      outline: none;
      cursor: pointer;
      margin-left: 1.2rem;
      padding: 0.22rem 0.37rem;
      border-radius: 7px;
      transition: background 0.18s;
      display: flex;
      align-items: center;
    }
    .cf-edit-btn:hover {
      background: #ffe0c2;
    }
    .cf-edit-icon {
      width: 22px;
      height: 22px;
      fill: var(--cf-orange);
      transition: fill 0.15s;
    }
    .cf-edit-btn:hover .cf-edit-icon {
      fill: #ffb47e;
    }
    .cf-no-files {
      color: #b2adc7;
      padding: 1.5em 0;
      text-align: center;
    }
    .cf-footer {
      color: #b2adc7;
      text-align: center;
      margin: 3rem 0 0 0;
      font-size: 0.99em;
      letter-spacing: 0.1px;
    }
    .cf-profile-card {
      position: absolute;
      top: 30px; right: 10px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 14px #22243a14;
      border: 1px solid var(--cf-border);
      padding: 1.2em 1.6em 1.2em 1em;
      min-width: 230px;
      max-width: 300px;
      display: flex;
      align-items: center;
      gap: 1em;
      z-index: 10;
      transition: box-shadow 0.2s;
    }
    .cf-profile-avatar {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: 2.5px solid var(--cf-orange);
      object-fit: cover;
      background: #ffe0c2;
    }
    .cf-profile-info {
      flex: 1;
      min-width: 0;
    }
    .cf-profile-username {
      font-weight: 700;
      color: var(--cf-dark);
      font-size: 1.07em;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }
    .cf-profile-link {
      display: inline-block;
      margin-top: 0.2em;
      color: var(--cf-orange);
      font-size: 0.97em;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.16s;
    }
    .cf-profile-link:hover { color: #ffb47e; }
    @media (max-width:900px) {
      .cf-profile-card { position: static; margin: 0 auto 1.5em auto; display: block; text-align: center; }
      .cf-profile-avatar { display: block; margin: 0 auto 0.6em auto; }
      .cf-profile-info { text-align: center; }
    }
    @media (max-width:650px) {
      .cf-profile-card { min-width:unset; max-width:unset; padding:1.2em 0.7em; }
      .cf-profile-avatar { width:40px; height:40px; }
    }
  </style>
</head>
<body>
  <div id="cf-loader" class="cf-loader">
    <div class="cf-loader-logo">
      <img src={logoUrl} alt="Code Unit Logo" style="width:52px; height:52px;" />
    </div>
    <div style="font-weight:700;font-size:1.22em;color:var(--cf-orange);letter-spacing:0.2px;">Code Unit</div>
    <div class="cf-loader-dots" aria-label="Loading...">
      <div class="cf-dot"></div>
      <div class="cf-dot"></div>
      <div class="cf-dot"></div>
    </div>
  </div>
  <nav class="cf-sidebar">
    <div style="display:flex;flex-direction:column;align-items:center;gap:1.2em;">
      <img src={logoUrl} alt="Code Unit Logo" style="width:44px;height:44px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #f3802012;">
    </div>
    <div class="cf-side-nav">
      <a class="cf-side-link active" href="/">
        <svg viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 0 0-1.414 0l-7 7A1 1 0 0 0 3 11h1v6a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-3h2v3a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-6h1a1 1 0 0 0 .707-1.707l-7-7z"></path></svg>
        Home
      </a>
      <a class="cf-side-link" href="/about">
        <svg viewBox="0 0 20 20"><path d="M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16zm0 4a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm0 10c-2.21 0-4.2-1.17-5.2-3 .03-2 4-3.1 5.2-3.1 1.2 0 5.17 1.1 5.2 3.1-1 1.83-3 3-5.2 3z"></path></svg>
        About
      </a>
      <a class="cf-side-link" href="/profile">
        <svg viewBox="0 0 20 20"><path d="M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16zm0 4a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm0 10c-2.21 0-4.2-1.17-5.2-3 .03-2 4-3.1 5.2-3.1 1.2 0 5.17 1.1 5.2 3.1-1 1.83-3 3-5.2 3z"></path></svg>
        Profile
      </a>
      <a class="cf-side-link" href={`https://github.com/${user}`} target="_blank" rel="noopener">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.484 2 12.021c0 4.427 2.867 8.18 6.839 9.504.5.092.682-.217.682-.482 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.342-3.369-1.342-.454-1.154-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.031 1.531 1.031.892 1.53 2.341 1.088 2.91.833.091-.647.349-1.087.635-1.338-2.221-.253-4.555-1.112-4.555-4.951 0-1.093.39-1.987 1.029-2.686-.103-.254-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0 1 12 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.748-1.026 2.748-1.026.546 1.378.202 2.396.1 2.65.64.699 1.028 1.593 1.028 2.686 0 3.849-2.337 4.695-4.566 4.943.359.309.678.919.678 1.852 0 1.336-.012 2.417-.012 2.746 0 .267.181.578.688.48C19.135 20.197 22 16.447 22 12.021 22 6.484 17.522 2 12 2z"></path></svg>
        GitHub
      </a>
    </div>
  </nav>
  <div class="cf-topbar">
    <img class="cf-topbar-logo" src={logoUrl} alt="Logo" />
    <span class="cf-topbar-title">Code Unit</span>
  </div>
  <main class="cf-main">
    <div id="cf-profile-inset"></div>
    <section class="cf-section">
      <div class="cf-card">
        <div class="cf-card-h">Your Files</div>
        <div class="cf-desc">
          Welcome to <b>Code Unit</b> — your personal dashboard for storing and editing code snippets, scripts, and raw text files.<br/>
          <span style="color:var(--cf-gray);font-size:0.97em;">
            (This instance is for <b>personal use</b>, but you can <a href="https://github.com/{user}/{repo}" target="_blank" style="color:var(--cf-orange);font-weight:600;">clone it here</a>)
          </span>
        </div>
        {files.length > 0 ? (
          <ul class="cf-file-list">
            {files.map(file => (
              <li class="cf-file-row">
                <a class="cf-file-link" href={`/texts/${file}`} target="_blank" rel="noopener">{file}</a>
                <a
                  class="cf-edit-btn"
                  href={`https://github.com/${user}/${repo}/edit/${branch}/public/texts/${file}`}
                  title="Edit on GitHub"
                  target="_blank"
                  rel="noopener"
                >
                  <svg class="cf-edit-icon" viewBox="0 0 20 20">
                    <path d="M14.85 2.15a2.121 2.121 0 0 1 3 3l-9.04 9.04a1 1 0 0 1-.47.26l-4.24 1.06a.5.5 0 0 1-.61-.61l1.06-4.24a1 1 0 0 1 .26-.47l9.04-9.04zm2.12.88a1.121 1.121 0 0 0-1.59 0l-1.13 1.13 1.59 1.59 1.13-1.13a1.121 1.121 0 0 0 0-1.59zM13.07 5.93l-8.28 8.28-.64 2.57 2.57-.64 8.28-8.28-2.13-2.13z"></path>
                  </svg>
                </a>
              </li>
            ))}
          </ul>
        ) : (
          <div class="cf-no-files">
            <b>No files yet.</b> Add text/code files to <code>public/texts/</code> in the repo.<br>
            They’ll show up here!
          </div>
        )}
      </div>
    </section>
    <div class="cf-footer">
      &copy; {new Date().getFullYear()} {user} · Code Unit
    </div>
  </main>
  <script>
    // Cloudflare-style loading screen logic
    (() => {
      const loader = document.getElementById("cf-loader");
      let minTime = 1000, maxTime = 2000;
      let shownAt = Date.now();
      function hideLoader() {
        loader.classList.add('hide');
        setTimeout(() => loader.style.display = 'none', 600);
      }
      window.addEventListener('DOMContentLoaded', () => {
        const elapsed = Date.now() - shownAt;
        if (elapsed < minTime) {
          setTimeout(hideLoader, minTime - elapsed);
        } else {
          hideLoader();
        }
        setTimeout(hideLoader, maxTime); // in case page loads very fast
      });
    })();

    // GitHub profile fetch for inset card
    (async () => {
      const container = document.getElementById('cf-profile-inset');
      if (!container) return;
      try {
        const res = await fetch('https://api.github.com/users/romemasters');
        if (!res.ok) throw new Error('Failed');
        const user = await res.json();
        container.innerHTML = `
          <div class="cf-profile-card">
            <img class="cf-profile-avatar" src="${user.avatar_url}" alt="${user.login}'s avatar" />
            <div class="cf-profile-info">
              <div class="cf-profile-username">${user.name || user.login}</div>
              <a class="cf-profile-link" href="${user.html_url}" target="_blank" rel="noopener">@${user.login}</a>
            </div>
          </div>
        `;
      } catch (e) {
        container.innerHTML = '';
      }
    })();
  </script>
</body>
</html>
