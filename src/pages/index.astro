---
// src/pages/index.astro

import fs from 'fs';
import path from 'path';

const user = "romemasters";
const repo = "romes-cool-projects";
const branch = "main";
const textsDir = path.resolve('public', 'texts');
const files = fs.existsSync(textsDir) ? fs.readdirSync(textsDir) : [];
const logoUrl = "https://raw.githubusercontent.com/romemasters/romes-cool-projects/refs/heads/main/public/468-4684000_png-file-svg-easy-storage-icon-transparent-png.png";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Code Unit · Personal Code Locker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
      :root {
        --bg-main: #f8fafc;
        --bg-panel: #1a1d23;
        --bg-card: #23262c;
        --accent: #ffa500;
        --accent-dark: #e69500;
        --text-main: #23262c;
        --text-light: #fff;
        --text-muted: #7c8a9a;
        --border: #2d3138;
      }
      body {
        margin: 0;
        background: var(--bg-main);
        font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
        min-height: 100vh;
        color: var(--text-main);
        display: flex;
        flex-direction: row;
      }
      .sidebar {
        background: var(--bg-panel);
        color: var(--text-light);
        width: 230px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2.5rem 1rem 1.5rem 1rem;
        box-shadow: 2px 0 12px #181a1f22;
        position: fixed;
        left: 0;
        top: 0;
        z-index: 20;
      }
      .logo {
        width: 58px;
        height: 58px;
        border-radius: 16px;
        background: #fff;
        padding: 5px;
        margin-bottom: 1.2rem;
        box-shadow: 0 4px 18px #ffa50012;
      }
      .brand {
        font-weight: 800;
        font-size: 1.45rem;
        letter-spacing: 0.7px;
        color: var(--accent);
        margin-bottom: 2.5rem;
        text-shadow: 0 2px 10px #181a1f33;
      }
      .nav {
        display: flex;
        flex-direction: column;
        width: 100%;
        margin-top: 1rem;
      }
      .nav-link {
        display: flex;
        align-items: center;
        color: var(--text-light);
        text-decoration: none;
        font-size: 1.07em;
        padding: 0.75em 1em;
        border-radius: 8px;
        margin-bottom: 0.5em;
        font-weight: 600;
        transition: background 0.17s, color 0.17s;
        gap: 0.7em;
      }
      .nav-link.active, .nav-link:hover {
        background: var(--accent);
        color: #23262c;
      }
      .nav-link svg {
        width: 1.3em;
        height: 1.3em;
        fill: currentColor;
      }
      main {
        margin-left: 230px;
        width: 100%;
        max-width: 870px;
        margin-right: auto;
        padding: 2.8rem 2rem 2rem 2.5rem;
        min-height: 100vh;
      }
      @media (max-width: 900px) {
        main { padding-left: 1rem; }
      }
      @media (max-width: 650px) {
        .sidebar {
          width: 100vw;
          flex-direction: row;
          justify-content: flex-start;
          height: 4.2rem;
          min-height: unset;
          padding: 0.6rem 1rem;
          position: fixed;
          left: 0; top: 0;
          right: 0;
        }
        .logo { width: 38px; height: 38px; margin-bottom: 0; }
        .brand { font-size: 1.05rem; margin-bottom: 0; }
        .nav { flex-direction: row; margin-top: 0; }
        .nav-link { margin-bottom: 0; margin-right: 0.7em; padding: 0.4em 0.8em;}
        main { margin-left: 0; padding: 5.5rem 0.5rem 1rem 0.5rem; }
      }
      .header-title {
        font-weight: bold;
        font-size: 2.1rem;
        margin-bottom: 0.6rem;
        color: #23262c;
      }
      .header-desc {
        color: #596475;
        margin-bottom: 2.3rem;
        font-size: 1.12rem;
      }
      .card {
        background: var(--bg-card);
        color: var(--text-light);
        border-radius: 1rem;
        padding: 2rem 1.6rem 1.4rem 1.6rem;
        box-shadow: 0 4px 24px #181a1f09;
        max-width: 650px;
        margin-bottom: 2.5rem;
      }
      .file-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .file-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.8em 0.6em;
        border-radius: 0.7em;
        margin-bottom: 0.5em;
        transition: background 0.13s;
        background: #292d36;
        border: 1px solid #27292f;
        box-shadow: 0 1px 6px #23262c12;
      }
      .file-row:hover {
        background: #32363e;
      }
      .file-link {
        color: var(--accent);
        text-decoration: none;
        font-size: 1.09em;
        font-weight: 500;
        letter-spacing: 0.2px;
        transition: color 0.18s;
      }
      .file-link:hover {
        color: #ffd574;
        text-decoration: underline;
      }
      .edit-btn {
        background: none;
        border: none;
        outline: none;
        cursor: pointer;
        margin-left: 1rem;
        padding: 0.18rem 0.23rem;
        border-radius: 6px;
        transition: background 0.18s;
        display: flex;
        align-items: center;
      }
      .edit-btn:hover {
        background: #1a1d23;
      }
      .edit-icon {
        width: 22px;
        height: 22px;
        fill: var(--accent);
        transition: fill 0.15s;
      }
      .edit-btn:hover .edit-icon {
        fill: #ffd574;
      }
      .no-files {
        color: #b2adc7;
        padding: 1.5em 0;
        text-align: center;
      }
      .footer {
        color: #b2adc7;
        text-align: center;
        margin: 3rem 0 0 0;
        font-size: 0.99em;
        letter-spacing: 0.1px;
      }
    </style>
  </head>
  <body>
    <nav class="sidebar">
      <img src={logoUrl} class="logo" alt="Code Unit Logo" />
      <div class="brand">Code Unit</div>
      <div class="nav">
        <a class="nav-link active" href="/">
          <svg viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 0 0-1.414 0l-7 7A1 1 0 0 0 3 11h1v6a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-3h2v3a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-6h1a1 1 0 0 0 .707-1.707l-7-7z"></path></svg>
          Home
        </a>
        <a class="nav-link" href="/about">
          <svg viewBox="0 0 20 20"><path d="M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16zm0 4a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm0 10c-2.21 0-4.2-1.17-5.2-3 .03-2 4-3.1 5.2-3.1 1.2 0 5.17 1.1 5.2 3.1-1 1.83-3 3-5.2 3z"></path></svg>
          About
        </a>
        <a class="nav-link" href={`https://github.com/${user}/${repo}`} target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.484 2 12.021c0 4.427 2.867 8.18 6.839 9.504.5.092.682-.217.682-.482 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.342-3.369-1.342-.454-1.154-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.031 1.531 1.031.892 1.53 2.341 1.088 2.91.833.091-.647.349-1.087.635-1.338-2.221-.253-4.555-1.112-4.555-4.951 0-1.093.39-1.987 1.029-2.686-.103-.254-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0 1 12 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.748-1.026 2.748-1.026.546 1.378.202 2.396.1 2.65.64.699 1.028 1.593 1.028 2.686 0 3.849-2.337 4.695-4.566 4.943.359.309.678.919.678 1.852 0 1.336-.012 2.417-.012 2.746 0 .267.181.578.688.48C19.135 20.197 22 16.447 22 12.021 22 6.484 17.522 2 12 2z"></path></svg>
          GitHub
        </a>
      </div>
    </nav>
    <main>
      <div class="header-title">Your Code Locker</div>
      <div class="header-desc">
        Welcome to <b>Code Unit</b> — your personal dashboard for storing, viewing, and editing code snippets, scripts, and raw text files.<br>
        <span style="color:var(--text-muted);font-size:0.97em;">
          (This instance is for <b>personal use</b>. Want your own? <a href="https://github.com/{user}/{repo}" target="_blank" style="color:var(--accent);font-weight:600;">Clone it here!</a>)
        </span>
      </div>
      <section class="card">
        <h2 style="margin:0 0 1.2em 0; font-size:1.25rem; color:#ffd574;">Stored Files</h2>
        {files.length > 0 ? (
          <ul class="file-list">
            {files.map(file => (
              <li class="file-row">
                <a class="file-link" href={`/texts/${file}`} target="_blank" rel="noopener">{file}</a>
                <a
                  class="edit-btn"
                  href={`https://github.com/${user}/${repo}/edit/${branch}/public/texts/${file}`}
                  title="Edit on GitHub"
                  target="_blank"
                  rel="noopener"
                >
                  <svg class="edit-icon" viewBox="0 0 20 20">
                    <path d="M14.85 2.15a2.121 2.121 0 0 1 3 3l-9.04 9.04a1 1 0 0 1-.47.26l-4.24 1.06a.5.5 0 0 1-.61-.61l1.06-4.24a1 1 0 0 1 .26-.47l9.04-9.04zm2.12.88a1.121 1.121 0 0 0-1.59 0l-1.13 1.13 1.59 1.59 1.13-1.13a1.121 1.121 0 0 0 0-1.59zM13.07 5.93l-8.28 8.28-.64 2.57 2.57-.64 8.28-8.28-2.13-2.13z"></path>
                  </svg>
                </a>
              </li>
            ))}
          </ul>
        ) : (
          <div class="no-files">
            <b>No files yet.</b> Add your text/code files to <code>public/texts/</code> in the repo.<br>
            They'll show up here!
          </div>
        )}
      </section>
      <div class="footer">
        &copy; {new Date().getFullYear()} {user} · Code Unit
      </div>
    </main>
  </body>
</html>
